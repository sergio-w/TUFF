<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JustStudy CE</title>
  <link rel="icon" type="image/x-icon" href="data:image/vnd.microsoft.icon;base64,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" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  <style>
    :root {
      --background: #36393f;
      --sidebar: #2f3136;
      --chat-bg: #36393f;
      --secondary-bg: #2c2f33;
      --text-color: #dcddde;
      --accent-color: #7289da;
      --border-color: #202225;
      --input-bg: #202225;
    }

    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      color: var(--text-color);
      background-color: var(--background);
      overflow: hidden;
      transition: background 0.7s ease-in-out;
    }

    .maincontent {
      display: flex;
      flex-direction: row;
      height: 100vh;
    }

    .leftsidecontent {
      width: 4vw;
      background-color: var(--sidebar);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 1vw;
      box-sizing: border-box;
      overflow-y: scroll;
      scrollbar-width: none;
      overflow-x: hidden;
    }

    .rightsidecontent {
      width: 11vw;
      background-color: var(--sidebar);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 1vw;
      box-sizing: border-box;
      overflow-y: scroll;
      scrollbar-width: none;
      overflow-x: hidden;
    }

    .chatcontent {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: var(--chat-bg);
      position: relative;
      scrollbar-width: none;
    }

    .content {
      overflow-x: hidden;
      overflow-y: scroll;
      scrollbar-color: var(--secondary-bg) var(--border-color);
      scrollbar-width: thin;
      flex: 1;
      padding: 1vw;
      box-sizing: border-box;
      background-color: var(--background);
      background-image: radial-gradient(circle,
          rgba(255, 255, 255, 0.171) 5%,
          rgba(255, 255, 255, 0) 5%);
      background-size: 4.5vw 4.5vw;
      background-position: -0.5vw -0.4vw;
    }

    .content::-webkit-scrollbar {
      width: 8px;
      background-color: var(--secondary-bg);
      border-radius: 50%;
    }

    .content::-webkit-scrollbar-thumb {
      background-color: var(--border-color);
      border-radius: 50%;
    }

    .content::-webkit-scrollbar-button {
      display: none;
    }

    .bottombar {
      display: flex;
      background-color: var(--secondary-bg);
      padding: 0.5vw;
    }

    .textinput {
      flex: 1 1 auto;
      min-height: 4vh;
      max-height: 30vh;
      font-size: 1vw;
      background-color: var(--input-bg);
      border: none;
      color: var(--text-color);
      padding: 1vh 1vw;
      outline: none;
      border-radius: 0.5vw;
      resize: none;
      overflow-y: scroll;
      line-height: 2vh;
      box-sizing: border-box;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .textinput::-webkit-scrollbar {
      display: none;
    }

    .leftsidecontent-inputfield {
      background-color: var(--input-bg);
      border: none;
      padding: 0.4vw;
      margin: 0.4vw;
      width: 13vw;
      color: var(--text-color);
      outline: none;
      border-radius: 0.2vw;
    }

    .content-bt {
      background-color: var(--accent-color);
      border: none;
      padding: 0.6vw;
      margin: 0.4vw;
      width: 14vw;
      color: #fff;
      cursor: pointer;
      border-radius: 0.2vw;
      font-size: 1vw;
    }

    .content-bt:hover {
      opacity: 0.9;
    }

    .white-text {
      font-size: 1vw;
      margin-left: 1.5vw;
      padding: 0.4vw;
      color: var(--text-color);
    }

    .textbox {
      background-color: var(--secondary-bg);
      padding: 0.7vw;
      border-radius: 0.4vw;
      margin: 0.4vw;
      max-width: 83vw;
      width: auto;
      font-size: 1vw;
      word-break: break-all;
      white-space: pre-line;
    }

    .textbox-name {
      font-size: 0.9vw;
      margin-left: 0.4vw;
      padding: 0.4vw;
      display: flex;
      align-items: center;
    }

    .bg {
      position: fixed;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      z-index: -1;
      background: linear-gradient(120deg, rgb(48, 0, 223), rgb(22, 0, 104));
    }

    .leftsidecontent-icon-container {
      width: 3vw;
      height: 3vw;
      justify-content: center;
      align-items: center;
      margin-bottom: 1vw;
    }

    .group-icon-container {
      width: 3vw;
      height: 3vw;
      justify-content: center;
      align-items: center;
      margin-bottom: 1vw;
      backdrop-filter: blur(1.6vw);
      -webkit-backdrop-filter: blur(1vw);
      background-color: rgba(116, 116, 116, 0.2);
      border-radius: 2vw;
      transition: all 0.3s ease;
    }

    .group-icon-container:hover {
      border-radius: 0.5vw;
      background-color: rgba(125, 255, 166, 0.581);
    }

    .leftsidecontent-icon {
      transition: all 0.4s ease;
      border-radius: 2vw;
      border: #7289da00 0.15vw solid;
    }

    .leftsidecontent-icon:hover {
      border: #ffc400 0.15vw solid;
      border-radius: 0.5vw;
    }

    .popup {
      display: none;
      position: fixed;
      background: rgb(27, 27, 27);
      border: 0.01vw solid rgb(107, 107, 107);
      border-radius: 0.5vw;
      padding: 0.5vw;
      color: white;
      font-size: 0.7vw;
      transform: translateY(20%);
      transition: all 0.2s ease;
      box-shadow: 0.1vw 0.1vw 0.2vw rgba(0, 0, 0, 0.5);
      z-index: 9999;
    }

    .userinfo-container {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      width: 100%;
    }

    .usericon-container {
      width: 2.5vw;
      height: 2.5vw;
      margin-bottom: 1.5vw;
      margin-top: 1.5vw;
      border-radius: 1.5vw;
      overflow: hidden;
      justify-content: center;
      align-items: center;
      display: flex;
      position: relative;
      border: 0.15vw solid var(--accent-color);
    }

    .usericon {
      border-radius: 2vw;
    }

    .AddGroupPopup {
      width: 20vw;
      height: 27vw;
      background-color: var(--sidebar);
      border-radius: 1vw;
      position: fixed;
      left: 50%;
      top: 50%;
      display: none;
      flex-direction: column;
      align-items: center;
      transform: translate(-50%, -50%);
      transition: all 0.1s ease;
      opacity: 0;
      font-family: comfortaa, sans-serif;
      z-index: 9000;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      opacity: 0;
      display: none;
      z-index: 7000;
    }

    .ShowOverlayAnim {
      animation: ShowOverlay ease-in 0.2s forwards;
    }

    .HideOverlayAnim {
      animation: HideOverlay ease-out 0.2s forwards;
    }

    @keyframes ShowOverlay {
      0% {
        opacity: 0;
        display: none;
      }

      100% {
        display: block;
        opacity: 0.5;
      }
    }

    @keyframes HideOverlay {
      0% {
        opacity: 0.5;
        display: block;
      }

      100% {
        opacity: 0;
        display: none;
      }
    }

    .smoothshow {
      animation: AddGroupPopupShow ease-in 0.15s forwards;
    }

    .smoothhide {
      animation: AddGroupPopupHide ease-out 0.15s forwards;
    }

    @keyframes AddGroupPopupShow {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @keyframes AddGroupPopupHide {
      0% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    .popuptext {
      font-size: 2vw;
      color: white;
    }

    .custominput {
      flex: 0 1 auto;
      height: 2vw;
      font-size: 1vw;
      background-color: var(--input-bg);
      border: none;
      color: var(--text-color);
      padding: 0.3vw 0.5vw;
      outline: none;
      border-radius: 0.2vw;
      margin-top: 0.4vw;
      margin-bottom: 0.4vw;
    }

    .LoginBox {
      width: 30vw;
      height: 25vw;
      background-color: var(--sidebar);
      border-radius: 1vw;
      position: fixed;
      left: 50%;
      top: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translate(-50%, -50%);
      transition: all 0.1s ease;
      font-family: comfortaa, sans-serif;
    }

    .logininput {
      flex: 0 1 auto;
      height: 2vw;
      font-size: 1vw;
      width: 20vw;
      background-color: var(--input-bg);
      border: none;
      color: var(--text-color);
      padding: 0.3vw 0.5vw;
      outline: none;
      border-radius: 0.2vw;
      margin-top: 0.4vw;
      margin-bottom: 0.4vw;
    }

    .login-bt {
      background-color: var(--accent-color);
      border: none;
      padding: 0.6vw;
      margin: 0.4vw;
      width: 21vw;
      color: #fff;
      cursor: pointer;
      border-radius: 0.2vw;
      font-size: 1vw;
    }

    .login-bt:hover {
      opacity: 0.9;
    }

    .loginerrorpopup {
      height: 2vw;
      width: 20vw;
      border-radius: 0.2vw;
      position: absolute;
      text-align: center;
      background-color: #3baa56;
      font-size: 1vw;
      left: 40vw;
    }

    .ErrorPopupShow {
      animation: ErrorPopupShow ease-out 0.15s forwards;
    }

    @keyframes ErrorPopupShow {
      0% {
        top: 100vh;
      }

      100% {
        top: 95vh;
      }
    }

    .ErrorPopupHide {
      animation: ErrorPopupHide ease-out 0.15s forwards;
    }

    @keyframes ErrorPopupHide {
      0% {
        top: 95vh;
      }

      100% {
        top: 100vh;
      }
    }

    .group-header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 0.2vw;
      border-bottom: 0.05vw solid var(--border-color);
    }

    .group-name {
      font-size: 1vw;
      margin-left: 0.5vw;
      font-weight: bold;
      color: var(--text-color);
      display: flex;
      align-items: center;
    }

    .settings-icon {
      font-size: 1.2vw;
      color: var(--text-color);
      cursor: pointer;
      transition: color 0.3s;
      margin-right: 0.5vw;
    }

    .settings-icon:hover {
      color: var(--accent-color);
    }

    .user-info {
      width: 100%;
      display: flex;
      align-items: center;
      padding: 0.5vw 1vw;
      border-top: 0.05vw solid var(--border-color);
    }

    .user-info img {
      width: 2vw;
      height: 2vw;
      border-radius: 50%;
      margin-right: 0.5vw;
    }

    .user-name {
      font-size: 0.9vw;
      color: var(--text-color);
      margin-right: 0.5vw;
      display: flex;
      align-items: center;
    }

    .userlist-content {
      overflow-y: auto;
      overflow-x: hidden;
      flex: 1;
      scrollbar-width: none;
      width: 100%;
      box-sizing: border-box;
    }

    .popup-leaveGroupButton {
      background-color: #20222500;
      border: none;
      margin: 0.4vw;
      width: 99%;
      height: 2vw;
      color: #fff;
      cursor: pointer;
      border-radius: 0.2vw;
      font-size: 1vw;
      transition: all 0.1s ease-in-out;
      text-align: center;
    }

    .popup-leaveGroupButton:hover {
      background-color: #ff5a70;
    }

    .popup-CopyID {
      background-color: #20222500;
      border: none;
      margin: 0.4vw;
      width: 95%;
      height: 2vw;
      color: #fff;
      cursor: pointer;
      border-radius: 0.2vw;
      font-size: 1vw;
      transition: all 0.1s ease;
    }

    .popup-CopyID:hover {
      background-color: var(--accent-color);
    }

    .CustomPopup {
      width: 20vw;
      background-color: var(--sidebar);
      border-radius: 1vw;
      position: fixed;
      padding-bottom: 0.5vw;
      padding-top: 0.5vw;
      left: 50%;
      top: 50%;
      display: none;
      flex-direction: column;
      align-items: center;
      transform: translate(-50%, -50%);
      transition: all 0.1s ease;
      opacity: 0;
      font-family: comfortaa, sans-serif;
      z-index: 9999;
    }

    @keyframes CustomPopupShow {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @keyframes CustomPopupHide {
      0% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    .copyidcontainer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 95%;
      border-radius: 0.5vw;
      background-color: var(--input-bg);
    }

    .copyidinput {
      width: 13vw;
      height: 2vw;
      margin-left: 0.2vw;
      font-size: 1vw;
      background-color: #20222500;
      outline: none;
      color: white;
      border: none;
    }

    .GroupSettingsPopup {
      width: 20vw;
      background-color: var(--sidebar);
      border-radius: 1vw;
      position: fixed;
      padding: 1vw;
      left: 50%;
      top: 50%;
      display: none;
      flex-direction: column;
      align-items: center;
      transform: translate(-50%, -50%);
      transition: all 0.1s ease;
      opacity: 0;
      font-family: comfortaa, sans-serif;
      z-index: 9001;
    }

    .GroupSettingsPopupShow {
      animation: CustomPopupShow ease-in 0.15s forwards;
    }

    .GroupSettingsPopupHide {
      animation: CustomPopupHide ease-out 0.15s forwards;
    }

    .GroupSettingsTitle {
      font-size: 1.4vw;
      margin-bottom: 1vw;
    }

    .group-settings-input {
      width: 90%;
      margin-bottom: 0.5vw;
      background-color: var(--input-bg);
      color: white;
      border: none;
      border-radius: 0.3vw;
      height: 2vw;
      font-size: 1vw;
      padding-left: 0.5vw;
      margin-top: 0.3vw;
    }

    .kick-list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 97%;
      font-size: 1vw;
      height: 2vw;
      background-color: var(--accent-color);
      margin-bottom: 0.1vw;
      margin-top: 0.1vw;
      padding-left: 0.5vw;
      border-radius: 0.2vw;
    }

    .kick-button {
      background-color: #ff5a70;
      border: none;
      border-radius: 0.3vw;
      cursor: pointer;
      font-size: 0.8vw;
      padding: 0.3vw 0.5vw;
    }

    .kick-button:hover {
      opacity: 0.9;
    }

    .UserSettingsOverlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      opacity: 0;
      display: none;
      z-index: 2000;
    }

    .UserSettingsPopup {
      width: 20vw;
      background-color: var(--sidebar);
      border-radius: 1vw;
      position: fixed;
      left: 50%;
      top: 50%;
      display: none;
      flex-direction: column;
      align-items: center;
      transform: translate(-50%, -50%);
      transition: all 0.1s ease;
      opacity: 0;
      z-index: 3000;
      font-family: comfortaa, sans-serif;
    }

    .UserSettingsPopupShow {
      animation: CustomPopupShow ease-in 0.15s forwards;
    }

    .UserSettingsPopupHide {
      animation: CustomPopupHide ease-out 0.15s forwards;
    }

    .user-settings-icon {
      font-size: 1.2vw;
      color: var(--text-color);
      cursor: pointer;
      transition: color 0.3s;
    }

    .user-settings-icon:hover {
      color: var(--accent-color);
    }

    .usersettingscontainer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 95%;
      border-radius: 0.5vw;
      background-color: var(--input-bg);
      margin-bottom: 1vw;
    }

    /* Badge icon images / placeholders */
    .badge-icon {
      width: 1.5vw;
      height: 1.5vw;
      margin-left: 0.3vw;
      display: inline-block;
      vertical-align: middle;
      object-fit: contain;
    }

    .emojipicker {
      position: fixed;
      display: none;
      top: 53%;
      height: 39vh;
      width: 20vw;
    }

    .emoji-bt {
      background-color: #00000000;
      font-size: 1.5vw;
      border: none;
      outline: none;
      text-align: center;
      vertical-align: middle;
    }

    .gelatineeffect {
      animation: gelatine 0.5s forwards;
    }

    @keyframes gelatine {

      from,
      to {
        transform: scale(1, 1);
      }

      25% {
        transform: scale(0.9, 1.1);
      }

      50% {
        transform: scale(1.1, 0.9);
      }

      75% {
        transform: scale(0.95, 1.05);
      }
    }

    .file-upload-container {
      display: flex;
      align-items: center;
      gap: 0.5vw;
    }

    .file-label {
      display: inline-block;
      background-color: var(--accent-color);
      color: #fff;
      padding: 0.6vw 1.2vw;
      border-radius: 0.4vw;
      cursor: pointer;
      transition: background-color 0.3s ease;
      white-space: nowrap;
      margin-right: 0.5vw;
    }

    .file-label:hover {
      background-color: #5a6fb2;
    }

    .file-label:active {
      background-color: #425187;
    }

    .file-label+input[type="file"] {
      display: none;
    }

    .chatinputcontainer {
      display: flex;
      align-items: center;
      gap: 0.5vw;
      padding: 0.5vw;
      background-color: var(--input-bg);
      border-radius: 0.5vw;
    }

    .textinput {
      flex: 1;
      margin: 0;
    }

    .chatinputcontainer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      border-radius: 0.5vw;
      background-color: var(--input-bg);
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .useractive {
      outline: 0.2vw solid var(--sidebar);
      height: 0.6vw;
      width: 0.6vw;
      border-radius: 50%;
      position: absolute;
      bottom: 0;
      right: 0;
    }

    .messagetime {
      font-size: 0.8vw;
      color: var(--text-color);
      margin-left: 0.5vw;
      margin-right: 0.5vw;
    }

    .audioplayer {
      display: flex;
      align-items: center;
      width: 20vw;
      min-height: 4vw;
      border-radius: 0.5vw;
      background-color: var(--input-bg);
      margin-bottom: 1vw;
    }

    .playbt {
      font-size: 1.2vw;
      background-color: var(--accent-color);
      color: var(--text-color);
      height: 2.5vw;
      width: 2.5vw;
      outline: none;
      border: none;
      margin-left: 0.35vw;
      border-radius: 0.5vw;
      cursor: pointer;
      transition: color 0.3s;
    }

    .audiotimeline {
      width: 9vw;
      height: 0.5vw;
    }

    .cf-turnstile {
      display: block !important;
      visibility: visible !important;
      width: 100% !important;
      height: auto !important;
    }

    .BannedBox {
      width: 30vw;
      height: 25vw;
      background-color: var(--sidebar);
      border-radius: 1vw;
      position: fixed;
      left: 50%;
      top: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translate(-50%, -50%);
      transition: all 0.1s ease;
      font-family: comfortaa, sans-serif;
    }
  </style>
</head>

<body>
  <div class="maincontent" id="maincontent"></div>
  <div class="bg"></div>
  <div class="overlay"></div>
  <div class="AddGroupPopup" id="AddGroupPopup">
    <span class="popuptext" style="margin-bottom: 0.4vw; margin-top: 0.8vw; font-weight: bold">Join a group</span>
    <span class="popuptext" style="
          margin-bottom: 1vw;
          margin-left: 0.5vw;
          margin-right: 0.5vw;
          font-weight: 100;
          font-size: 1vw;
          text-align: center;
        ">Input a group id and then you can chat with your buddys</span>
    <input class="custominput" placeholder="Enter URL here" id="joingroupid" />
    <button class="content-bt" onclick='joinGroup(document.getElementById("joingroupid").value)'>
      Join
    </button>
    <span class="popuptext" style="
          margin-bottom: 2vw;
          margin-left: 0.5vw;
          margin-right: 0.5vw;
          margin-top: 1vw;
          font-weight: 100;
          font-size: 1vw;
          text-align: center;
        ">Or</span>
    <span class="popuptext" style="
          margin-bottom: 1vw;
          margin-left: 0.5vw;
          margin-right: 0.5vw;
          font-weight: 100;
          font-size: 1vw;
          text-align: center;
        ">
      Make a group</span>
    <input class="custominput" placeholder="Enter Group name here" id="creategroupname" />
    <button class="content-bt" onclick='createGroup(document.getElementById("creategroupname").value)'>
      Create
    </button>
  </div>
  <div id="GroupSettingsPopup" class="GroupSettingsPopup">
    <div class="GroupSettingsTitle">Group Settings</div>
    <label style="width: 90%; font-size: 1vw">Server Name</label>
    <input class="group-settings-input" id="groupSettingsName" placeholder="Enter new group name" />
    <label style="width: 90%; font-size: 1vw">Server Icon URL</label>
    <input class="group-settings-input" id="groupSettingsIcon" placeholder="Enter icon URL" />
    <label style="width: 90%; font-size: 1vw">Members</label>
    <div id="groupSettingsMembers" style="
          width: 90%;
          max-height: 6vw;
          overflow-y: auto;
          border: 1px solid var(--border-color);
          border-radius: 0.3vw;
          margin-bottom: 1vw;
          padding: 0.3vw;
        "></div>
    <button class="content-bt" style="width: 40%" onclick="saveGroupSettings()">
      Save
    </button>
  </div>
  <div id="UserSettingsOverlay" class="UserSettingsOverlay"></div>
  <div id="UserSettingsPopup" class="UserSettingsPopup"></div>
  <script>
    let socket = null;
    let serverlocation = "wss://chat-wss.juststudy.uk";
    let alternativeserverlocation =
      "ws://chattingisveryveryfuninmathslessons.juststudy.uk:9001";
    let username = null;
    let myuuid = customUuid();
    let currentGroup = null;
    let currentGroupOwner = null;
    let currentGroupMembers = [];
    let isRequestingSettings = false;
    let mytoken = null;
    let autoscroll = true;
    let addgroupdatauri = "data:image/png;base64,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"
    let normalgroupdatauri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAL8AAAC/CAMAAACYNP00AAACnVBMVEUAAAD//wCA/4Cq/1WA/4CZ/2aq/4CS/22f/4Cq/3GZ/4Ci/3SV/4Cd/3ak/4CZ/3ef/4CW/3ic/4Ch/3mZ/3Oe/3mi/3Sb/3qf/3WZ/3qd/3ah/3ub/3ae/3uZ/3ec/3uf/3ib/3ye/3ig/3yc/3if/3ya/3md/3yf/3mb/3aa/3ec/3qf/3eb/3qd/3ef/3qc/3ie/3qb/3id/3uf/3ic/3ue/3mb/3ud/3me/3uc/3md/3ef/3me/3mb/3id/3qe/3ic/3qe/3ib/3qd/3ie/3qc/3id/3qf/3me/3mc/3ue/3ec/3md/3ib/3md/3ie/3mc/3id/3qe/3ic/3qe/3id/3ie/3qc/3md/3qc/3me/3md/3md/3me/3id/3ic/3id/3qc/3ie/3mc/3qd/3md/3md/3qd/3qe/3mc/3ic/3id/3me/3id/3qc/3md/3qd/3mc/3qd/3me/3qc/3md/3ie/3md/3id/3mc/3id/3md/3md/3me/3md/3md/3qc/3md/3qe/3md/3qd/3mc/3qd/3me/3id/3md/3ie/3md/3id/3mc/3ie/3md/3md/3mc/3md/3me/3qd/3md/3mc/3qd/3me/3ic/3md/3md/3md/3md/3md/3me/3md/3md/3qc/3md/3qd/3md/3me/3id/3md/3md/3me/3md/3md/3mc/3md/3md/3md/3md/3me/3md/3md/3qd/3md/3id/3md/3id/3mc/3md/3md/3md/3md/3me/3md/3md/3md/3md/3md/3md/3md/3md/3md/3qd/3md/3me/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3md/3n///9WqaoeAAAA3XRSTlMAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyAhIiMkJSYnKCkrLC0uLzAxMjM0NTY3ODk6Ozw9P0BBQkNERUZHSElKTE1PUFFSU1RVVldYWVtcXV5fYWNlZmhqa2xub3Byc3V2d3l6e4CBgoWGh4iJiouMjY6PkZKTlJWWl5iZmpucnZ6foKGio6Wmp6ipqquvsLGytbe4u72+v8DBwsPExsfIycvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6err7O3u7/Dx8vP09fb3+Pn6+/z9/osvIpgAAAABYktHRN7pbuKbAAAE3UlEQVQYGe3B+3/NdRwH8NfXse3YlM3cRcw1tXBcRlFYjdxKqZaVyBQrQsJQoimU0dy6mNINOyGSuYZldjCbmG3svP6XHj32eNi+53y/ss/3+/nyw/v5hBBCCCGEEEIIIYQQQgghhBBCCCGEAmNg5pzFczMHG3BHsyGZOYvnvDrQgBe6f1zCeufX9IJzvdeUst65j7pBt1YratigdlVrOJO8upYNqnMfhFY9jtDsZD840buYZsf6QKPAZUaqHA51T1Qy0qUB0KbDOUa7mAJVD5cx2vnO0MT4hVaCPqjxHaCVHw3oMZXWsqDmDVp7AVr4TtBaSRxU+P+mteM+6PAU7YyDivG0MwI6rKCdPKj4nHaWQYeDtHMCKk7Rzn7ocJl2bhhoOqOadi5Cg7gwbSWj6drQVtgP97WgvbZoura0FfZDg3LaqTbQdEYN7VyCDodp5zRUnKGd36HDKtpZDxVf0s5K6JBOOxOgYjLtjIIOMedorSweKhJCtHY2Blpk0doMqJlFa5nQw7efVo7EQE1sMa0UNYMm3UKMVtkPqvpeYbRLKdBm5DVGuvEs1GXcYKRrI6BR6l80Kx0KJ9JKaVYSgFbtN9axQfirTnDmoYIwG9RtaAvdHt9cwXpXtwyCc4O3/sN6FZtS4YXYZ7KXrFs2e2wc3OEfO3vZuiXZ6bEQQgghhBBCCCGEEEIIL/n8uFf8PjjULbeYDBWMhPdGFoTI4txucGBmFevlx8Nb8fmsVzUTynJ4265YeCl2F2/LgaK0OjZYAC8tYIO6NKgpZCNVSfBOUhUbKYSSdmE2lgXvZLGxcDuoyKDJWnjnM5pkQMVUmuyBd4I0mQoV6TS5FgOv+Ktpkg4VXWg2FF55mmYdoaScJvPglUU0KYOaH2hSBK8co8lOqFlAk3AfeGMIzd6DmtE0WwpvrKfZMKiJr6JJRSK80KWGJhXNoWgHzRbAC2tplg9V02h2vSv0G3CLZhOgKvE6zb4zoFvsAZpd9kPZF4wwC7rlMsJyqBvOCLWjoFdmmGbhvnDgZ0a4PgI6Tb7JCDvgxDhGuhKAPhNrGSEcgBPGXka6NgWaGDm3GGkHnEkLM1J4YTPo0HIro9T0hEP5jLY3Fe4bd5rRPoRTbcoYrXZxAtzVaQstFLeAY8/TSmhuS7in88oqWriVBhd8SkuheZ3gjsfWVNPSu3BD3D5au/nNhBg4lTSjiDa2G3BFx+O0U77ppVZQ1yO7sIZ29jwAl3Q9S3u1Py16rjWarve0vKO8g98S4Zpepbyj8J8F8yb1bIa7kzAoa+nOEO/sUDJc1C/E/1dz8vsN86dPGvFIWx+itew6MOOV7Nxt+y7wLhxtD1elHGJT1JSfORoMBvcUFu4OBoMHT5VdZZMUJsNlCdvonbzmcJ2RU0dv3HgNWow6QS/82g+atJhfQ92uZPugT+pe6rW5A7QyxhdRn8I0aGdM3E8twl8PgieMsdtr6baKvP7wTofsQ3RTcHoCvGWkffAHXVG76+3uuCdSsndepTMlG19shXvI1/+tTWeo5Gbwo5e74H6Q+OSbn+wuDfNuVR/fvnBqaizuL3G9xrz+/uptuw9fqKaVytP7vt24/J0paR0N3OeMpM49A4HA6DH/GRYIPJqSnAAhhBBCCCGEEEIIIYQQQgghhBBCCC3+BSrTR1m81xJOAAAAAElFTkSuQmCC";
    let normaluserdatauri = "data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIzNjAiIGhlaWdodD0iMzYwIiB2aWV3Qm94PSIwLDAsMzYwLDM2MCI+PGRlZnM+PGxpbmVhckdyYWRpZW50IHgxPSIyNDEuNTc2MTIiIHkxPSIyMTUuNzA1OTQiIHgyPSIyNDEuNTc2MTIiIHkyPSIzNjAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBpZD0iY29sb3ItMSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMDAwMDAwIiBzdG9wLW9wYWNpdHk9IjAiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMwMDAwMDAiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCB4MT0iMjM3LjYxMDkzIiB5MT0iMTQ0LjI5NDA2IiB4Mj0iMjM3LjYxMDkzIiB5Mj0iMCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGlkPSJjb2xvci0yIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiMwMDAwMDAiIHN0b3Atb3BhY2l0eT0iMCIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC43ODgwNiwwKSI+PGcgZGF0YS1wYXBlci1kYXRhPSJ7JnF1b3Q7aXNQYWludGluZ0xheWVyJnF1b3Q7OnRydWV9IiBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtZGFzaG9mZnNldD0iMCIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOiBub3JtYWwiPjxwYXRoIGQ9Ik00MDAuMzcwNiwyMDEuOTkzNThjMCw2Ni44MDg1MSAtMzAuMTgyNjYsMTU4LjAwNjQyIC0xNTguNzk0NDgsMTU4LjAwNjQyYy0xMjguNjExODIsMCAtMTYzLjUyMjg1LC05My41NjIwOSAtMTYzLjUyMjg1LC0xNjAuMzcwNmMwLC0zMi41MDcxNyAtMi4wMzQzNywxMS41MDAxIDE1LjgwNzAxLDYwLjMyNzA5YzkuNTU3MTMsMjYuMTU1MjYgMTYuODU3MjUsMzcuMTE1MDMgMzMuNzI4MTcsNTQuMTE5NjdjMzAuNDM2NDMsMzAuNjc3NjggNzEuNTAzNjgsNDUuMTM1NzcgMTEzLjk4NzY3LDQ1LjEzNTc3YzM4LjEwMzE4LDAgNzkuMjI3MzQsLTExLjc4Mjg4IDEwNy4yOTcwOSwtMzcuNzIxMzdjMTguMjk1NjgsLTE2LjkwNjU0IDE4Ljg2OTA1LC0xNy41NjU0MyAyOC4yNTc2MiwtMzYuMDk2M2MyNC44MjY1NiwtNDkuMDAxOTIgMjMuMjM5NzcsLTExNy41MTUyMSAyMy4yMzk3NywtODMuNDAwNjl6IiBmaWxsPSJ1cmwoI2NvbG9yLTEpIiBzdHJva2Utd2lkdGg9IjAiLz48cGF0aCBkPSJNNjAuNzg4MDYsMzYwdi0zNjBoMzYwdjM2MHoiIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0ibm9uZSIvPjxnIHN0cm9rZS13aWR0aD0iMCI+PHBhdGggZD0iTTExOS4zODAxMywyNjMuOTc2OTNjMCwtNjYuNjE2NTIgNTQuMDAzMzYsLTEyMC42MTk4OCAxMjAuNjE5ODgsLTEyMC42MTk4OGM2Ni42MTY1MiwwIDEyMC42MTk4Nyw1NC4wMDMzNiAxMjAuNjE5ODcsMTIwLjYxOTg4YzAsMzMuMzkxMDUgLTI0LjQyMTU4LDk1LjYzNjE1IC0xMjEuMDY5Niw5Ni4wMjEyN2MtOTguMDUwNjgsMC4zOTA3MSAtMTIwLjE3MDE0LC02Mi43OTU4MSAtMTIwLjE3MDE0LC05Ni4wMjEyN3oiIGZpbGw9IiNkNWQ1ZDUiLz48cGF0aCBkPSJNMjkyLjUxOTE2LDE1Ny4zOTI3MmMwLDI5LjAwNTUzIC00Ny45MDQyNywyOS45NDIyOSAtNTIuNTE5MTYsMjkuOTQyMjljLTYuMDk1MzMsMCAtNTEuNTk0OTksLTAuOTUxNDggLTUyLjUxOTE2LC0yOS45NDIyOGMtMC4xODQwNywtNS43NzQyNCAyNS43OTU5NCwtMTEuMTcyMDMgNTEuOTYwNjQsLTExLjM0MjI1YzI2LjQ0NDUsLTAuMTcyMDQgNTMuMDc3NjcsNC45NDgxNCA1My4wNzc2NywxMS4zNDIyNXoiIGZpbGwtb3BhY2l0eT0iMC41MDE5NiIgZmlsbD0iIzAwMDAwMCIvPjxwYXRoIGQ9Ik0xNjguNjUyOTMsOTUuMzQ0MDVjMCwtMzkuNDAzNjMgMzEuOTQyOTYsLTcxLjM0NjU5IDcxLjM0NjU5LC03MS4zNDY1OWMzOS40MDM2MywwIDcxLjM0NjU5LDMxLjk0Mjk2IDcxLjM0NjU5LDcxLjM0NjU5YzAsMzkuNDAzNjMgLTMxLjk0Mjk2LDcxLjM0NjU5IC03MS4zNDY1OSw3MS4zNDY1OWMtMzkuNDAzNjMsMCAtNzEuMzQ2NTksLTMxLjk0Mjk2IC03MS4zNDY1OSwtNzEuMzQ2NTh6IiBmaWxsPSIjZDVkNWQ1Ii8+PC9nPjxwYXRoIGQ9Ik03OC44MTY0NSwxNTguMDA2NDJjMCwtNjYuODA4NTEgMzAuMTgyNjUsLTE1OC4wMDY0MiAxNTguNzk0NDcsLTE1OC4wMDY0MmMxMjguNjExODIsMCAxNjMuNTIyODUsOTMuNTYyMDkgMTYzLjUyMjg1LDE2MC4zNzA2YzAsMzIuNTA3MTcgMi4wMzQzNywtMTEuNTAwMSAtMTUuODA3MDEsLTYwLjMyNzFjLTkuNTU3MTMsLTI2LjE1NTI2IC0xNi44NTcyNSwtMzcuMTE1MDIgLTMzLjcyODE3LC01NC4xMTk2N2MtMzAuNDM2NDMsLTMwLjY3NzY4IC03MS41MDM2OCwtNDUuMTM1NzcgLTExMy45ODc2NywtNDUuMTM1NzhjLTM4LjEwMzE4LDAgLTc5LjIyNzM0LDExLjc4Mjg4IC0xMDcuMjk3MDksMzcuNzIxMzhjLTE4LjI5NTY4LDE2LjkwNjU0IC0xOC44NjkwNiwxNy41NjU0MyAtMjguMjU3NjIsMzYuMDk2MjljLTI0LjgyNjU1LDQ5LjAwMTkyIC0yMy4yMzk3NywxMTcuNTE1MjEgLTIzLjIzOTc3LDgzLjQwMDY5eiIgZmlsbD0idXJsKCNjb2xvci0yKSIgc3Ryb2tlLXdpZHRoPSIwIi8+PC9nPjwvZz48L3N2Zz48IS0tcm90YXRpb25DZW50ZXI6MTc5LjIxMTkzODA2NTUwNTE0OjE4MC4wMDAwMDAwMDAwMDAxLS0+";
    const cssVariables = [
      "--accent-color",
      "--secondary-bg",
      "--sidebar",
      "--text-color",
      "--input-bg",
      "--background",
    ];
    cssVariables.forEach((variable) => {
      const storedValue = localStorage.getItem(variable);
      if (storedValue) {
        document.body.style.setProperty(variable, storedValue);
      }
    });

    function showBannedScreen(reason) {
      const maincontainer = document.getElementById("maincontent");
      maincontainer.innerHTML = `
        <div class='BannedBox'>
          <span style='font-size:2vw; text-align: center; width: 20vw; margin-top: 1vw; font-weight: bold'>Account Banned</span>
          </br></br>
          <span style='font-size:1vw; text-align: center; width: 20vw; margin-top: 0.5vw; margin-bottom: 1vw;'>Reason: ${reason}</span>
          <span style='font-size:0.8vw; text-align: center; width: 20vw; font-weight: italic'>If you believe this is an error, please contact support.</span>
        </div>`;
    }



    function InitLogin() {
      const maincontainer = document.getElementById("maincontent");
      maincontainer.classList.add("smoothhide");
      maincontainer.addEventListener(
        "animationend",
        function handleAnimationEnd() {
          maincontainer.classList.remove("smoothhide");
          maincontainer.classList.add("smoothshow");
          maincontainer.removeEventListener(
            "animationend",
            handleAnimationEnd
          );

          // maincontainer.innerHTML =
          //   "<div class='LoginBox' id='loginbox'>" +
          //   "<span style='font-size:2vw; text-align: center; width: 20vw; margin-top: 1vw;'>Login</span>" +
          //   "<span style='font-size:1vw; text-align: center; width: 20vw; margin-top: 0.5vw; margin-bottom:0.5vw'>Login to start chatting with your buddies</span>" +
          //   "<span style='font-size:0.8vw; text-align: left; width: 20vw;'>Username<code style='color:red'>*</code></span>" +
          //   "<input id='login-username' class='logininput' placeholder='Enter Username here'></input>" +
          //   "<span style='font-size:0.8vw; text-align: left; width: 20vw;'>Password<code style='color:red'>*</code></span>" +
          //   "<input id='login-password' class='logininput' type='password' placeholder='Enter Password here'></input>" +
          //   "<div class='cf-turnstile' data-sitekey='0x4AAAAAAA6CH1nnSGPXUk04' data-theme='dark' id='login-turnstile'></div>" +
          //   "<button class='login-bt' onclick='Login()'>Login</button>" +
          //   "<span style='font-size:0.8vw; text-align: left; width: 20vw;'>Don't have an account? <a style='color:lightblue;' href='#' onclick='InitRegister()'>Register</a></span>" +
          //   "</div>";

          maincontainer.innerHTML = `
          <div class="LoginBox">
            <span style="font-size: 2vw; text-align: center; width: 20vw; margin-top: 1vw;">Login</span>
            <span style="font-size: 1vw; text-align: center; width: 20vw; margin-top: 0.5vw; margin-bottom: 1vw;">Login to start chatting with your buddies</span>
            
            <span style="font-size: 0.8vw; text-align: left; width: 20vw;">Username<code style="color: red">*</code></span>
            <input id="login-username" class="logininput" placeholder="Enter Username here">
            
            <span style="font-size: 0.8vw; text-align: left; width: 20vw;">Password<code style="color: red">*</code></span>
            <input id="login-password" class="logininput" type="password" placeholder="Enter Password here">
            
            <button class="login-bt" id="loginbox" onclick="Login()">Login</button>
            
            <span style="font-size: 0.8vw; text-align: left; width: 20vw;">Don't have an account? 
              <a style="color: lightblue;" href="#" onclick="InitRegister()">Register</a>
            </span>
          </div>`;

          document.getElementById("loginbox").addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              Login();
            }
          });
          const nuhuh =  `
            <!-- Cloudflare Turnstile Widget -->
            </br>
            <center>
              <div class="cf-turnstile" data-sitekey="0x4AAAAAAA6CH1nnSGPXUk04" data-theme="dark" id="login-turnstile"></div>
            </center>
          `;
          document.getElementById("login-username").focus();
          // turnstile.render('#login-turnstile', {
          //   sitekey: '0x4AAAAAAA6CH1nnSGPXUk04',
          //   theme: 'dark'
          // });

        }
      );
    }

    function InitRegister() {
      const maincontainer = document.getElementById("maincontent");
      maincontainer.classList.add("smoothhide");
      maincontainer.addEventListener(
        "animationend",
        function handleAnimationEnd() {
          maincontainer.classList.remove("smoothhide");
          maincontainer.classList.add("smoothshow");
          maincontainer.removeEventListener(
            "animationend",
            handleAnimationEnd
          );

          maincontainer.innerHTML =
            "<div class='LoginBox'>" +
            "<span style='font-size:2vw; text-align: center; width: 20vw; margin-top: 1vw;'>Register</span>" +
            "<span style='font-size:1vw; text-align: center; width: 20vw; margin-top: 0.5vw; margin-bottom:0.5vw'>Register to start chatting with your buddies</span>" +
            "<span style='font-size:0.8vw; text-align: left; width: 20vw;'>Username<code style='color:red'>*</code></span>" +
            "<input id='register-username' class='logininput' placeholder='Enter Username here'></input>" +
            "<span style='font-size:0.8vw; text-align: left; width: 20vw;'>Password<code style='color:red'>*</code></span>" +
            "<input id='register-password' class='logininput' type='password' placeholder='Enter Password here'></input>" +
            "<div class='cf-turnstile' data-sitekey='0x4AAAAAAA6CH1nnSGPXUk04'></div>" +
            "<button class='login-bt' onclick='Register()'>Register</button>" +
            "<span style='font-size:0.8vw; text-align: left; width: 20vw;'>Already have an account? <a style='color:lightblue;' href='#' onclick='InitLogin()'>Login</a></span>" +
            "</div>";
        }
      );
    }

    function InitChat() {
      const maincontainer = document.getElementById("maincontent");
      maincontainer.classList.add("smoothhide");
      currentGroup = null;
      isRequestingSettings = false;
      maincontainer.addEventListener(
        "animationend",
        function handleAnimationEnd() {
          maincontainer.classList.remove("smoothhide");
          maincontainer.classList.add("smoothshow");
          maincontainer.removeEventListener(
            "animationend",
            handleAnimationEnd
          );

          maincontainer.innerHTML =
            "<div class='leftsidecontent' id='leftsidecontent'>" +
            "<div class='group-icon-container' id='AddGroup'>" +
            `<img src='${addgroupdatauri}' class='leftsidecontent-icon' style='width:95%;height:95%;'>` +
            "</div>" +
            "</div>" +
            "<div class='chatcontent'>" +
            "<div id='content' class='content'></div>" +
            "<div class='bottombar'>" +
            `<emoji-picker class="emojipicker" id="emojipicker"></emoji-picker>` +
            "<div class='chatinputcontainer'>" +
            "<div class='file-upload-container'>" +
            '<label for="fileUpload" id="fileLabel" class="file-label"><i class="fa fa-upload" aria-hidden="true"></i></label>' +
            '<input type="file" id="fileUpload" accept="*" style="display: none;" />' +
            "</div>" +
            "<textarea class='textinput' id='textinput' placeholder='Enter something to text' rows=1></textarea>" +
            `<button class='emoji-bt' style='width:2.5vw;' id="emoji-bt">ðŸ˜Š</button>` +
            "</div>" +
            "</div>" +
            "</div>" +
            "<div class='rightsidecontent' id='rightsidecontent'>" +
            "<div class='group-header'>" +
            "<span class='group-name'>No Group :(</span>" +
            "<i class='fa fa-cog settings-icon'></i>" +
            "</div>" +
            "<div class='userlist-content' id='userlist-content'></div>" +
            "<div class='user-info'>" +
            `<img src='${normaluserdatauri}' alt='User Icon'>` +
            "<span class='user-name'>" +
            (username || "Username") +
            "</span>" +
            "<i class='fa fa-cog user-settings-icon' id='usersettings'></i>" +
            "</div>" +
            "</div>";

          loadData();
          InitInput();
          initGroupContent();
          const fileInput = document.getElementById("fileUpload");
          const fileLabel = document.getElementById("fileLabel");
          const maxSizeMB = 50;
          const maxSizeBytes = maxSizeMB * 1024 * 1024;

          fileInput.addEventListener("change", () => {
            if (fileInput.files.length > 0) {
              const file = fileInput.files[0];
              if (file.size > maxSizeBytes) {
                MakeErrorMessage("File size exceeded. 50mb MAX...");
                fileInput.value = "";
                fileLabel.textContent = "Choose File";
              } else {
                fileLabel.textContent = file.name;
              }
            }
          });
          document
            .getElementById("content")
            .addEventListener("scroll", (event) => {
              const { scrollHeight, scrollTop, clientHeight } = event.target;

              if (Math.abs(scrollHeight - clientHeight - scrollTop) < 1) {
                autoscroll = true;
              } else {
                autoscroll = false;
              }
            });
          const random_emoji = [
            "ðŸ˜Š",
            "ðŸ˜‰",
            "ðŸ˜Ž",
            "ðŸ˜€",
            "ðŸ˜ƒ",
            "ðŸ˜„",
            "ðŸ˜",
            "ðŸ˜†",
            "ðŸ˜…",
            "ðŸ˜‚",
            "ðŸ¤£",
            "ðŸ˜Š",
            "ðŸ˜‡",
            "ðŸ™‚",
            "ðŸ™ƒ",
            "ðŸ˜‰",
          ];
          const emojibt = document.getElementById("emoji-bt");
          emojibt.addEventListener("mouseenter", () => {
            emojibt.innerText =
              random_emoji[Math.floor(Math.random() * random_emoji.length)];
            emojibt.classList.remove("gelatineeffect");
            emojibt.classList.add("gelatineeffect");
            emojibt.addEventListener("animationend", () => {
              emojibt.classList.remove("gelatineeffect");
            });
          });
          emojibt.addEventListener("click", () => {
            if (
              document.getElementById("emojipicker").style.display == "flex"
            ) {
              document.getElementById("emojipicker").style.display = "none";
            } else {
              document.getElementById("emojipicker").style.display = "flex";
            }
            emojibt.innerText =
              random_emoji[Math.floor(Math.random() * random_emoji.length)];
            emojibt.classList.remove("gelatineeffect");
            emojibt.classList.add("gelatineeffect");
            emojibt.addEventListener("animationend", () => {
              emojibt.classList.remove("gelatineeffect");
            });
          });
          document
            .querySelector(".settings-icon")
            .addEventListener("click", () => {
              if (!currentGroup) {
                MakeErrorMessage("No group selected yet!", false);
                return;
              }
              isRequestingSettings = true;
              getGroupData();
            });

          document.getElementById("usersettings").addEventListener("click", openUserSettingsPopup);
        }
      );
    }

    function updateUserInfo(newUsername) {
      const userNameSpan = document.querySelector(".user-name");
      if (userNameSpan) {
        userNameSpan.textContent = newUsername;
      }
    }

    function CopyText(text) {
      navigator.clipboard.writeText(text);
    }

    function createGroupIdPopup(id) {
      const existingPopups = document.querySelectorAll(".CustomPopup");
      existingPopups.forEach((popup) => popup.remove());

      const overlay = document.createElement("div");
      overlay.classList.add("overlay");
      overlay.style.display = "block";
      overlay.classList.remove("HideOverlayAnim");
      overlay.classList.add("ShowOverlayAnim");

      const popup = document.createElement("div");
      popup.classList.add("CustomPopup");
      popup.classList.add("smoothshow");
      popup.style.display = "flex";
      popup.innerHTML =
        "<span class='popuptext' style='margin-bottom: 0.4vw; margin-top: 0.8vw; font-weight: bold;'>Invite People</span>" +
        "<span class='popuptext' style='margin-bottom: 1vw; margin-left: 0.5vw; margin-right: 0.5vw; font-weight: 100; font-size: 1vw; text-align: center;'>Click the copy button to copy the group ID.</span>" +
        "<div class='copyidcontainer'>" +
        "<input class='copyidinput' id='idinput' value='" +
        id +
        "' readOnly />" +
        "<button class='content-bt' style='width: 4vw;' onclick=\"CopyText('" +
        id +
        "'); MakeErrorMessage('Copied to clipboard!',true);\">Copy</button>" +
        "</div>";

      document.body.appendChild(overlay);
      document.body.appendChild(popup);

      overlay.addEventListener("click", () => {
        popup.classList.remove("smoothshow");
        popup.classList.add("smoothhide");
        popup.addEventListener("animationend", () => popup.remove());

        overlay.classList.remove("ShowOverlayAnim");
        overlay.classList.add("HideOverlayAnim");
        overlay.addEventListener("animationend", () => overlay.remove());
      });
    }

    function addGroupPopup() {
      const popup = document.getElementById("AddGroupPopup");
      const overlay = document.querySelector(".overlay");
      popup.style.display = "flex";
      popup.classList.remove("smoothhide");
      popup.classList.add("smoothshow");

      overlay.style.display = "block";
      overlay.classList.remove("HideOverlayAnim");
      overlay.classList.add("ShowOverlayAnim");

      popup.querySelectorAll("input").forEach((key) => {
        key.disabled = false;
      });

      overlay.addEventListener("click", () => {
        closeGroupPopup();
      });
    }

    function closeGroupPopup() {
      const popup = document.getElementById("AddGroupPopup");
      const overlay = document.querySelector(".overlay");

      popup.classList.remove("smoothshow");
      popup.classList.add("smoothhide");

      overlay.classList.remove("ShowOverlayAnim");
      overlay.classList.add("HideOverlayAnim");
      overlay.addEventListener("animationend", handleOverlayAnimationEnd);

      popup.querySelectorAll("input").forEach((key) => {
        key.disabled = true;
      });
    }

    function initGroupContent() {
      const popup = document.createElement("div");
      popup.classList.add("popup");
      popup.textContent = "Add Group";
      document.body.appendChild(popup);

      const container = document.getElementById("AddGroup");
      container.addEventListener("mouseover", () => {
        const rect = container.getBoundingClientRect();
        popup.style.display = "block";
        const viewportWidth = window.innerWidth;
        const leftInVW = ((rect.left + window.scrollX) / viewportWidth) * 100;
        popup.style.left = leftInVW + 4 + "vw";
        popup.style.top = rect.top + window.scrollY + "px";
      });

      container.addEventListener("click", () => {
        addGroupPopup();
      });

      container.addEventListener("mouseout", () => {
        popup.style.display = "none";
      });
    }

    const badgeEmojis = {
      developer: "ðŸ› ï¸",
      staff: "ðŸ›¡ï¸",
      verified: "âœ…",
      owner: "ðŸ‘‘",
      annoying: "ðŸ†",
    };

    function getAllBadgeIcons(badgesArray, isOwner, thetextdiv) {
      const container = document.createElement("span");
      container.style.display = "inline-flex";
      container.style.alignItems = "center";

      const orderedBadges = ["groupOwner", "developer", "staff", "annoying", "verified"];
      orderedBadges.forEach((b) => {
        if (badgesArray && badgesArray.includes(b)) {
          container.appendChild(
            document.createTextNode(badgeEmojis[b] + " ")
          );
        }
      });

      if (isOwner) {
        container.appendChild(
          document.createTextNode(badgeEmojis.owner + " ")
        );
      }

      return container;
    }
    const badgeColors = {
      developer: "#FF160C",
      staff: "#ff5a70",
      groupOwner: "#ffd700 ",
      verified: "#3baa56",
      annoying: "#800080",
      default: "var(--accent-color)",
    };

    function getProfileBadgeIcon(badgesArray, isOwner, textElement) {
      let chosen = null;

      if (badgesArray && badgesArray.includes("groupOwner")) {
        chosen = "groupOwner";
      } else if (badgesArray && badgesArray.includes("developer")) {
        chosen = "developer";
      } else if (badgesArray && badgesArray.includes("staff")) {
        chosen = "staff";
      } else if (badgesArray && badgesArray.includes("annoying")) {
        chosen = "annoying";
      } else if (badgesArray && badgesArray.includes("verified")) {
        chosen = "verified";
      }

      if (textElement) {
        if (isOwner) {
          textElement.style.color =
            badgeColors.groupOwner || badgeColors.default;
        } else {
          textElement.style.color =
            badgeColors[chosen] || badgeColors.default;
        }
      }

      const container = document.createElement("span");
      container.style.display = "inline-flex";
      container.style.alignItems = "center";

      if (chosen) {
        container.appendChild(
          document.createTextNode(badgeEmojis[chosen] + " ")
        );
      }

      if (isOwner) {
        container.appendChild(
          document.createTextNode(badgeEmojis.owner + " ")
        );
      }

      return container;
    }

    function makebox(text, name, isself, iconurl, badgesArray, isOwner, messagetime) {
      const container = document.createElement("div");
      container.style.display = "flex";
      container.style.flexDirection = "column";
      container.style.alignItems = isself ? "flex-end" : "flex-start";

      let chosen;
      const textdiv = document.createElement("span");
      textdiv.classList.add("textbox-name");

      if (badgesArray && badgesArray.includes("developer")) {
        chosen = "developer";
      } else if (badgesArray && badgesArray.includes("staff")) {
        chosen = "staff";
      } else if (badgesArray && badgesArray.includes("verified")) {
        chosen = "verified";
      }

      if (textdiv) {
        if (isOwner) {
          textdiv.style.color =
            badgeColors["groupOwner"] || badgeColors.default;
        } else {
          textdiv.style.color = badgeColors[chosen] || badgeColors.default;
        }
      }
      const nameSpan = document.createElement("span");
      nameSpan.innerText = name;
      const timeSpan = document.createElement("span");
      timeSpan.style.color = "var(--accent-color)";
      timeSpan.style.marginLeft = "0.5vw";
      timeSpan.style.fontSize = "1vw";
      timeSpan.innerText = messagetime;
      const badgesSpan = getAllBadgeIcons(badgesArray, isOwner, textdiv);
      textdiv.appendChild(nameSpan);
      textdiv.appendChild(badgesSpan);

      const box = document.createElement("div");
      box.classList.add("textbox");
      box.style.width = "auto";
      box.style.textAlign = "left";

      const userinfocontainer = document.createElement("div");
      userinfocontainer.classList.add("userinfo-container");

      const iconcontainer = document.createElement("div");
      iconcontainer.classList.add("usericon-container");

      const icon = document.createElement("img");
      icon.src = iconurl;
      icon.style.width = "100%";
      icon.style.height = "100%";
      icon.classList.add("usericon-icon");
      iconcontainer.appendChild(icon);

      userinfocontainer.appendChild(textdiv);
      userinfocontainer.appendChild(iconcontainer);
      userinfocontainer.appendChild(timeSpan);
      container.appendChild(userinfocontainer);

      container.appendChild(box);
      function isValidImage(urlTocheck = "") {
        var image = new Image();
        image.src = urlTocheck;
        if (image.width == 0) {
          return false;
        } else {
          return true;
        }
      }
      let textBuffer = "";
      const links = text.split(/( |\n)/);
      let current_index = 0;
      links.forEach((link) => {
        if (link.startsWith("http://") || link.startsWith("https://") || link.startsWith("*") || link.startsWith("~")) {
          if (textBuffer) {
            const textNode = document.createTextNode(textBuffer + " ");
            box.appendChild(textNode);
            textBuffer = "";
          }
          const fileExtension = link.split(".").pop().toLowerCase();
          const contentDiv = document.createElement("div");
          contentDiv.style.marginTop = "0.5vw";
          if (link.startsWith("*")) {
            let nextindex = 0;
            if (!link.endsWith("*")) {
              nextindex = links.findIndex((item, index) => item.includes("*") && index > current_index);
              if (nextindex !== -1) {
                link = links.slice(current_index, nextindex + 1).join(" ");
              }
            }
            const boldtext = document.createElement("span");
            boldtext.innerText = link.slice(1, link.length - 1);
            boldtext.style.fontWeight = "bold";
            box.appendChild(boldtext);
            links.splice(current_index, nextindex);
          } else if (link.startsWith("~")) {
            let nextindex = 0;
            if (!link.endsWith("~")) {
              nextindex = links.findIndex((item, index) => item.includes("~") && index > current_index);
              if (nextindex !== -1) {
                link = links.slice(current_index, nextindex + 1).join(" ");
              }
            }
            const ilatictext = document.createElement("span");
            ilatictext.innerText = link.slice(1, link.length - 1);
            ilatictext.style.fontStyle = "italic";
            box.appendChild(ilatictext);
            links.splice(current_index, nextindex);
          } else if (isValidImage(link) != false) {
            const imgElement = document.createElement("img");
            imgElement.src = link;
            imgElement.style.maxWidth = "40vw";
            imgElement.style.height = "auto";
            imgElement.style.borderRadius = "1vw";
            imgElement.lazyload = true;
            contentDiv.appendChild(imgElement);
          } else if (["mp4", "webm", "gif"].includes(fileExtension)) {
            const videoElement = document.createElement("video");
            videoElement.src = link;
            videoElement.controls = true;
            videoElement.style.maxWidth = "40vw";
            videoElement.style.borderRadius = "0.5vw";
            videoElement.lazyload = true;
            contentDiv.appendChild(videoElement);
          } else if (["mp3", "ogg", "opus"].includes(fileExtension)) {
            const AudioElement = document.createElement("div");
            AudioElement.classList.add("audioplayer");

            var audio = new Audio(link);

            const PlayBT = document.createElement("button");
            PlayBT.classList.add("playbt");
            PlayBT.innerHTML = `<i class="fa fa-play" aria-hidden="true"></i>`;

            let isPlaying = false;
            let audiotime = "00:00";
            let fullaudiotime = "00:00";

            const AudioTime = document.createElement("span");
            AudioTime.style.fontSize = "0.9vw";
            AudioTime.style.whiteSpace = "nowrap";
            AudioTime.style.marginRight = "0.5vw";
            AudioTime.style.marginLeft = "0.5vw";
            AudioTime.textContent = `${audiotime} / ${fullaudiotime}`;

            const timeline = document.createElement("input");
            timeline.type = "range";
            timeline.min = 0;
            timeline.step = "0.01";
            timeline.classList.add("audiotimeline");
            timeline.style.flex = "1";
            timeline.style.marginRight = "1vw";

            const timeContainer = document.createElement("div");
            timeContainer.style.display = "flex";
            timeContainer.style.alignItems = "center";
            timeContainer.style.gap = "0.5vw";
            timeContainer.style.width = "100%";
            timeContainer.appendChild(AudioTime);
            timeContainer.appendChild(timeline);

            function formatTime(seconds) {
              const minutes = Math.floor(seconds / 60);
              const secs = Math.floor(seconds % 60);
              return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
            }

            PlayBT.addEventListener("click", () => {
              isPlaying = !isPlaying;
              PlayBT.innerHTML = isPlaying
                ? `<i class="fa fa-pause" aria-hidden="true"></i>`
                : `<i class="fa fa-play" aria-hidden="true"></i>`;
              if (isPlaying) {
                audio.play();
              } else {
                audio.pause();
              }
            });

            audio.addEventListener("timeupdate", () => {
              audiotime = formatTime(audio.currentTime);
              AudioTime.textContent = `${audiotime} / ${fullaudiotime}`;
              timeline.value = audio.currentTime;
              if (audio.currentTime == audio.duration) {
                timeline.value = timeline.max;
              }
            });

            audio.addEventListener("loadedmetadata", () => {
              fullaudiotime = formatTime(audio.duration);
              AudioTime.textContent = `${audiotime} / ${fullaudiotime}`;
              timeline.max = audio.duration;
            });

            AudioElement.appendChild(PlayBT);
            AudioElement.appendChild(timeContainer);

            contentDiv.appendChild(AudioElement);
          } else {
            const linkElement = document.createElement("a");
            linkElement.href = link;
            linkElement.innerText = link;
            linkElement.target = "_blank";
            linkElement.style.wordBreak = "break-word";
            box.appendChild(linkElement);
            const space = document.createTextNode(" ");
            box.appendChild(space);
          }
          container.appendChild(contentDiv);
        } else {
          textBuffer += link + " ";
        }
        current_index += 1;
      });
      if (textBuffer) {
        const textNode = document.createTextNode(textBuffer);
        box.appendChild(textNode);
      }

      if (box.innerText.trim() === "") {
        box.style.display = "none";
      }

      document.getElementById("content").appendChild(container);
      if (autoscroll) {
        document.getElementById("content").scrollTop =
          document.getElementById("content").scrollHeight;
      }
    }

    function makeGroup(name, iconurl, id) {
      const container = document.createElement("div");
      container.classList.add("leftsidecontent-icon-container");

      const icon = document.createElement("img");
      icon.src = iconurl;
      icon.style.width = "90%";
      icon.style.height = "90%";
      icon.classList.add("leftsidecontent-icon");
      container.appendChild(icon);

      document
        .getElementById("leftsidecontent")
        .insertBefore(container, document.getElementById("AddGroup"));

      const popup = document.createElement("div");
      popup.classList.add("popup");
      popup.textContent = name;
      document.body.appendChild(popup);

      container.addEventListener("mouseover", () => {
        const rect = container.getBoundingClientRect();
        popup.style.display = "block";
        const viewportWidth = window.innerWidth;
        const leftInVW = ((rect.left + window.scrollX) / viewportWidth) * 100;
        popup.style.left = leftInVW + 4 + "vw";
        popup.style.top = rect.top + window.scrollY + "px";
      });

      container.addEventListener("mouseout", () => {
        popup.style.display = "none";
      });

      container.addEventListener("click", () => {
        currentGroup = id;
        const packet = {
          type: "requestGroupData",
          groupID: id,
          userID: myuuid,
          username,
          token: mytoken,
        };
        socket.send(JSON.stringify(packet));
        setGroupName(name);
      });

      container.addEventListener("contextmenu", (event) => {
        event.preventDefault();
        const existingPopups = document.querySelectorAll(".popup");
        existingPopups.forEach((pop) => {
          if (pop !== popup) {
            document.body.removeChild(pop);
          }
        });
        const menupopup = document.createElement("div");
        menupopup.classList.add("popup");
        document.body.appendChild(menupopup);

        const rect = container.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const leftInVW = ((rect.left + window.scrollX) / viewportWidth) * 100;
        menupopup.style.left = leftInVW + 1 + "vw";
        menupopup.style.top = rect.top + window.scrollY + "px";

        const leaveGroupButton = document.createElement("button");
        leaveGroupButton.classList.add("popup-leaveGroupButton");
        leaveGroupButton.textContent = "Leave Group";
        leaveGroupButton.addEventListener("click", () => {
          kickUserFromGroup(username, currentGroup);
          document.body.removeChild(menupopup);
        });

        const CopyIdButton = document.createElement("button");
        CopyIdButton.classList.add("popup-CopyID");
        CopyIdButton.textContent = "Group ID";
        CopyIdButton.addEventListener("click", () => {
          createGroupIdPopup(id);
          document.body.removeChild(menupopup);
        });

        menupopup.appendChild(leaveGroupButton);
        menupopup.appendChild(CopyIdButton);

        menupopup.style.position = "absolute";
        menupopup.style.display = "flex";
        menupopup.style.flexDirection = "column";
        menupopup.style.alignItems = "center";
        menupopup.style.zIndex = "1000";
      });
    }

    function makeUser(name, iconurl, badges, isGroupOwner, isactive) {
      const container = document.createElement("div");
      container.style.display = "flex";
      container.style.flexDirection = "row";
      container.style.alignItems = "center";
      container.style.marginBottom = "0.5vw";
      container.style.height = "3vw";
      container.style.width = "95%";
      container.style.marginLeft = "0.5vw";

      const iconcontainer = document.createElement("div");
      iconcontainer.classList.add("usericon-container");
      iconcontainer.style.display = "flex";
      iconcontainer.style.alignItems = "center";
      iconcontainer.style.justifyContent = "center";
      iconcontainer.style.width = "2vw";
      iconcontainer.style.height = "2vw";
      iconcontainer.style.marginRight = "0.5vw";
      iconcontainer.style.flexShrink = "0";
      iconcontainer.style.flexGrow = "0";
      iconcontainer.style.overflow = "visible";
      iconcontainer.style.border = "none";
      const icon = document.createElement("img");
      icon.src = iconurl;
      icon.style.width = "90%";
      icon.style.height = "90%";
      icon.style.objectFit = "cover";
      icon.style.borderRadius = "50%";
      iconcontainer.appendChild(icon);
      container.appendChild(iconcontainer);

      const useractive = document.createElement("div");
      useractive.classList.add("useractive");
      iconcontainer.appendChild(useractive);
      useractive.style.backgroundColor = isactive ? "#7bf570" : "#8f6066";

      const nameDiv = document.createElement("div");
      nameDiv.style.fontWeight = "bold";
      nameDiv.style.flex = "1";
      nameDiv.style.overflow = "hidden";
      nameDiv.style.textOverflow = "ellipsis";
      nameDiv.style.whiteSpace = "nowrap";
      const textWrap = document.createElement("span");
      textWrap.innerText = name;
      nameDiv.appendChild(textWrap);

      const userBadgeSpan = getProfileBadgeIcon(
        badges,
        isGroupOwner,
        nameDiv
      );
      nameDiv.appendChild(userBadgeSpan);

      function updateFontSize() {
        const viewportWidth = window.innerWidth;
        const properFontSize = Math.max(
          5,
          Math.min(17, (viewportWidth / name.length) * 0.1)
        );
        nameDiv.style.fontSize = properFontSize + "px";
      }
      updateFontSize();
      window.addEventListener("resize", updateFontSize);

      container.appendChild(nameDiv);
      document.getElementById("userlist-content").appendChild(container);
    }

    function MakeErrorMessage(loginerr, success) {
      const loginerror = document.createElement("div");
      if (!success) {
        loginerror.style.background = "#ff3535d2";
      }
      loginerror.classList.add("loginerrorpopup", "ErrorPopupShow");
      loginerror.innerText = loginerr;
      document.body.appendChild(loginerror);

      loginerror.addEventListener(
        "animationend",
        function handleAnimationEnd() {
          if (loginerror.classList.contains("ErrorPopupShow")) {
            setTimeout(() => {
              loginerror.classList.remove("ErrorPopupShow");
              loginerror.classList.add("ErrorPopupHide");
            }, 2000);
          } else if (loginerror.classList.contains("ErrorPopupHide")) {
            loginerror.remove();
            loginerror.removeEventListener(
              "animationend",
              handleAnimationEnd
            );
          }
        }
      );
    }

    function Login() {
      if (socket.readyState !== WebSocket.OPEN) return;
      const usernameVal = document.getElementById("login-username").value.trim();
      const passwordVal = document.getElementById("login-password").value.trim(); 7
      //const turnstileResponse = document.querySelector('input[name="cf-turnstile-response"]').value;

      // if (!turnstileResponse) {
      //   MakeErrorMessage("Please complete the CAPTCHA.");
      //   return;
      // }


      if (usernameVal && passwordVal) {
        const payload = {
          type: "login",
          data: {
            username: usernameVal,
            password: passwordVal,
            userID: myuuid
            //turnstile: turnstileResponse,
          },
        };
        socket.send(JSON.stringify(payload));
      } else {
        MakeErrorMessage("Please fill out all fields");
      }
    }
    // this is the fingerprint thing. haha have fun making multiple accounts
    async function getFingerprint() {
      let visitorId = localStorage.getItem('visitorId');
      if (!visitorId) {
        const fp = await FingerprintJS.load();
        const result = await fp.get();
        visitorId = result.visitorId;
        localStorage.setItem('visitorId', visitorId); // Cache it
      }
      return visitorId;
    }

    async function Register() {
      const usernameVal = document
        .getElementById("register-username")
        .value.trim();
      const passwordVal = document
        .getElementById("register-password")
        .value.trim();

      if (!usernameVal || !passwordVal) {
        MakeErrorMessage("Please fill out all fields");
        return;
      }

      try {
        const visitorId = await getFingerprint();

        const payload = {
          type: "create_account",
          userID: myuuid,
          data: { username: usernameVal, password: passwordVal },
          deviceid: visitorId,
        };

        await socket.send(JSON.stringify(payload));

        alert("Account created successfully!");
        window.location.reload();
      } catch (error) {
        console.error("Error during registration:", error);
        MakeErrorMessage("An error occurred. Please try again later.");
      }
    }

    function InitInput() {
      const textinput = document.getElementById("textinput");
      const emojiinput = document.getElementById("search");
      const emojipicker = document.getElementById("emojipicker");
      document.querySelector('emoji-picker').addEventListener('emoji-click', event => {
        textinput.value += event.detail.emoji.unicode;
        emojiinput.focus();
        emojipicker.style.display = "none";
      });
      textinput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          if (
            e.key === "Enter" &&
            textinput.value !== "" &&
            socket &&
            currentGroup
          ) {
            const fileInput = document.getElementById("fileUpload");
            const date = new Date();
            const messagevalue = textinput.value;
            emojipicker.style.display = "none";
            // const naughtwordlist = JSON.parse(
            //   sessionStorage.getItem("nonowords")
            // );
            // const containsBadWord = naughtwordlist.some((word) =>
            //   messagevalue.toLowerCase().includes(word.toLowerCase())
            // );
            // if (containsBadWord) {
            //   MakeErrorMessage("No bad words allowed!", false);
            //   return;
            // }

            const file = fileInput.files && fileInput.files[0];

            if (file) {
              const formData = new FormData();
              formData.append('file', file);
              if (username === "Hauxy") {
                return MakeErrorMessage('File Uploads Locked for: 24 hours');
              }

              fetch(`https://skib.juststudy.uk/fileUpload?groupID=${currentGroup}&userID=${username}`, {
                method: "POST",
                body: formData,
              })
                .then((res) => res.json())
                .then((data) => {
                  var combinedMessage;
                  if (messagevalue !== "") {
                    combinedMessage = `${data.file} ${messagevalue}`;
                  } else {
                    combinedMessage = `${data.file}`;
                  }
                  const jsonpayload = {
                    type: "sendmessage",
                    groupID: currentGroup,
                    userID: myuuid,
                    message: combinedMessage,
                    username: username,
                    token: mytoken,
                  };
                  socket.send(JSON.stringify(jsonpayload));
                  textinput.value = "";
                  fileInput.value = "";
                  fileLabel.textContent = "Choose File";
                })
                .catch((err) => {
                  console.error(err);
                });
            } else {
              const jsonpayload = {
                type: "sendmessage",
                groupID: currentGroup,
                userID: myuuid,
                message: messagevalue,
                username: username,
                token: mytoken,
              };
              socket.send(JSON.stringify(jsonpayload));
              textinput.value = "";
            }
          } else if (socket && currentGroup) {
            if (e.key == ":") {
              emojipicker.style.display = "flex";
            } else {
              emojipicker.style.display = "none";
            }
          }
        }
      });
    }

    function customUuid(length = 200) {
      const randomValues = crypto.getRandomValues(new Uint8Array(length));
      return Array.from(randomValues, (byte) =>
        byte.toString(16).padStart(2, "0")
      ).join("");
    }

    function genClientKey() {
      const randomBytes = new Uint8Array(128);
      window.crypto.getRandomValues(randomBytes);
      const base64String = btoa(String.fromCharCode.apply(null, randomBytes));
      return base64String;
    }

    function loadData() { }

    function joinGroup(id) {
      closeGroupPopup();
      const packet = {
        type: "joingroup",
        id,
        userID: myuuid,
        username,
        token: mytoken,
      };
      socket.send(JSON.stringify(packet));
    }

    function createGroup(name) {
      closeGroupPopup();
      const packet = {
        type: "makegroup",
        groupname: name,
        userID: myuuid,
        username,
        token: mytoken,
      };
      socket.send(JSON.stringify(packet));
    }

    function UpdateGroupList(groups) {
      function waitForElement() {
        const leftSideContent = document.getElementById("leftsidecontent");
        if (leftSideContent) {
          clearInterval(checkInterval);
          leftSideContent.innerHTML =
            "<div class='group-icon-container' id='AddGroup'>" +
            `<img src='${addgroupdatauri}' class='leftsidecontent-icon' style='width: 95%; height: 95%;'>` +
            "</div>";
          initGroupContent();
          groups.forEach((group) => {
            makeGroup(group.name, group.icon, group.id);
          });
        }
      }
      const checkInterval = setInterval(waitForElement, 100);
    }

    function sendGroupPacket(uName) {
      myuuid = customUuid();
      const packet = {
        type: "GetUserGroupList",
        username: uName,
        userID: myuuid,
        token: mytoken,
      };
      socket.send(JSON.stringify(packet));
    }

    function getGroupData() {
      if (!currentGroup) return;
      const packet = {
        type: "requestGroupData",
        groupID: currentGroup,
        userID: myuuid,
        username,
        token: mytoken,
      };
      socket.send(JSON.stringify(packet));
    }

    function setGroupName(name) {
      const groupNameSpan = document.querySelector(".group-name");
      if (groupNameSpan) {
        groupNameSpan.textContent = name;
      }
    }

    function openGroupSettingsPopup(groupData) {
      const popup = document.getElementById("GroupSettingsPopup");
      const overlay = document.querySelector(".overlay");

      popup.style.display = "flex";
      popup.classList.remove("GroupSettingsPopupHide");
      popup.classList.add("GroupSettingsPopupShow");

      overlay.style.display = "block";
      overlay.classList.remove("HideOverlayAnim");
      overlay.classList.add("ShowOverlayAnim");

      document.getElementById("groupSettingsName").value =
        groupData.groupName || "";
      document.getElementById("groupSettingsIcon").value =
        groupData.groupIcon || "";
      currentGroupOwner = groupData.owner;
      currentGroupMembers = groupData.allmembers || [];

      const membersContainer = document.getElementById(
        "groupSettingsMembers"
      );
      membersContainer.innerHTML = "";

      currentGroupMembers.forEach((m) => {
        const row = document.createElement("div");
        row.classList.add("kick-list-item");
        row.innerHTML = "<span>" + m.username + "</span>";

        if (
          username === currentGroupOwner &&
          m.username !== currentGroupOwner
        ) {
          const kickBtn = document.createElement("button");
          kickBtn.classList.add("kick-button");
          kickBtn.textContent = "Kick";
          kickBtn.onclick = () => {
            kickUserFromGroup(m.username);
          };
          row.appendChild(kickBtn);
        }
        membersContainer.appendChild(row);
      });

      overlay.addEventListener("click", closeGroupSettingsPopup);
    }

    function closeGroupSettingsPopup() {
      const popup = document.getElementById("GroupSettingsPopup");
      const overlay = document.querySelector(".overlay");

      popup.classList.remove("GroupSettingsPopupShow");
      popup.classList.add("GroupSettingsPopupHide");
      popup.addEventListener("animationend", handlePopupAnimationEnd);

      overlay.classList.remove("ShowOverlayAnim");
      overlay.classList.add("HideOverlayAnim");
      overlay.addEventListener("animationend", handleOverlayAnimationEnd);
      overlay.removeEventListener("click", closeGroupSettingsPopup);

      isRequestingSettings = false;
    }

    function handlePopupAnimationEnd(event) {
      const popup = event.target;
      popup.style.display = "none";
      popup.removeEventListener("animationend", handlePopupAnimationEnd);
    }

    function handleOverlayAnimationEnd(event) {
      const overlay = event.target;
      overlay.style.display = "none";
      overlay.removeEventListener("animationend", handleOverlayAnimationEnd);
    }

    function kickUserFromGroup(user) {
      MakeErrorMessage("Requested to kick " + user, true);
      const packet = {
        type: "updategroup",
        groupID: currentGroup,
        userID: myuuid,
        requester: username,
        username,
        kickUser: user,
        token: mytoken,
      };
      socket.send(JSON.stringify(packet));
    }

    function saveGroupSettings() {
      const newName = document
        .getElementById("groupSettingsName")
        .value.trim();
      const newIcon = document
        .getElementById("groupSettingsIcon")
        .value.trim();
      MakeErrorMessage("Requested to save new settings", true);

      const packet = {
        type: "updategroup",
        groupID: currentGroup,
        requester: username,
        newName,
        username,
        newIcon,
        token: mytoken,
      };
      socket.send(JSON.stringify(packet));

      closeGroupSettingsPopup();
    }

    function refreshUserList(members) {
      const userlistContent = document.getElementById("userlist-content");
      if (userlistContent) {
        userlistContent.innerHTML = "";
        members.forEach((m) => {
          const isOwner = m.username === currentGroupOwner;
          makeUser(
            m.username,
            m.icon || normaluserdatauri,
            m.badges || [],
            isOwner,
            m.status
          );
        });
      }
    }

    function handleUserUpdate(action, user) {
      const userlistContent = document.getElementById("userlist-content");
      if (!userlistContent) return;

      if (action === "add") {
        makeUser(
          user.username,
          user.icon || normaluserdatauri,
          user.badges || [],
          user.isOwner || false,
          user.status
        );
      } else if (action === "remove") {
        const users = Array.from(userlistContent.children);
        users.forEach((userElement) => {
          if (
            userElement.querySelector("div") &&
            userElement
              .querySelector("div")
              .textContent.trim()
              .startsWith(user.username)
          ) {
            userlistContent.removeChild(userElement);
          }
        });
      }
    }
    function pingServer() {
      if (socket.readyState !== WebSocket.OPEN) return;
      setTimeout(() => {
        const packet = {
          type: "ping",
          username,
          token: mytoken,
        };
        socket.send(JSON.stringify(packet));
        pingServer();
      }, 3000);
    }

    function attemptReconnect() {
      if (socket.readyState === WebSocket.OPEN) return;
      setTimeout(() => {
        ConnectToServer();
        attemptReconnect();
      }, 500);
    }
    function updateUserListUI(members,Owner) {
      const userlistContent = document.getElementById("userlist-content");
      userlistContent.innerHTML = "";
      members.forEach((member) => {
        makeUser(member.username, member.icon, member.badges,Owner == member.username, member.status === "online", member.status === "online");
      });
    }
    async function ConnectToServer() {
      socket = new WebSocket(serverlocation);

      socket.onopen = () => {
        pingServer();
      };

      socket.addEventListener("message", async (event) => {
        try {
          const data = JSON.parse(event.data);
          if (data.status === "banned") {
            await console.log(data);
            await console.log(data.message || "Something went wrong...")
            showBannedScreen(data.message || "No reason provided");
          } else if (data.status !== "error") {
            if (data && data.userID === myuuid) {
              myuuid = customUuid();
              switch (data.type) {
                case "Login":
                  if (data.banned) {
                    showBannedScreen(data.message || "No reason provided");
                  } else {
                    if (data.failed) {
                      MakeErrorMessage('Something went wrong. Please try again...');
                    }
                    InitChat();
                    username = data.username;
                    mytoken = data.token;
                    MakeErrorMessage(data.message, true);
                    sendGroupPacket(username);
                    updateUserInfo(username);
                  }
                  break;
                case "CreateAccount":
                  MakeErrorMessage(data.message, true);
                  break;

                case "MakeGroup":
                  MakeErrorMessage(data.message, true);
                  break;

                case "JoinGroup":
                  MakeErrorMessage(data.message, true);
                  sendGroupPacket(username);
                  {
                    const joinGroupPacket = {
                      type: "requestGroupData",
                      groupID: data.groupID,
                      userID: myuuid,
                      username,
                      token: mytoken,
                    };
                    socket.send(JSON.stringify(joinGroupPacket));
                  }
                  break;

                case "groupMessages": {
                  const content = document.getElementById("content");
                  const memberslist =
                    document.getElementById("userlist-content");
                  if (content && memberslist) {
                    content.innerHTML = "";
                    memberslist.innerHTML = "";

                    const fixeddata = data.data;
                    const messages = fixeddata.data;
                    const members = fixeddata.allmembers;
                    currentGroupOwner = fixeddata.owner || null;

                    messages.forEach((msg) => {
                      const isOwner = msg.username === currentGroupOwner;
                      makebox(
                        msg.message,
                        msg.username,
                        false,
                        msg.icon || normaluserdatauri,
                        msg.badges || [],
                        isOwner,
                        msg.time
                      );
                    });

                    refreshUserList(members);
                    if (isRequestingSettings) {
                      openGroupSettingsPopup(fixeddata);
                    }
                  }
                  break;
                }
                case "CreateAccount":
                  MakeErrorMessage(data.message, true);
                  break;
                case "getGroupList":
                  UpdateGroupList(data.groups);
                  break;
                case "refreshGroupData":
                  {
                    loadData();
                    initGroupContent();
                    getGroupData();
                    sendGroupPacket(username);
                    if (data.data && data.data.groupid === currentGroup) {
                      const cont = document.getElementById("content");
                      const lst = document.getElementById("userlist-content");
                      if (cont && lst) {
                        cont.innerHTML = "";
                        lst.innerHTML = "";
                        const fix = data.data;
                        const msgList = fix.data || [];
                        const memList = fix.allmembers || [];
                        currentGroupOwner = fix.owner || null;

                        msgList.forEach((msg) => {
                          makebox(
                            msg.message,
                            msg.username,
                            false,
                            msg.icon || normaluserdatauri,
                            msg.badges || [],
                            msg.username === currentGroupOwner,
                            msg.time
                          );
                        });
                        refreshUserList(memList);
                      }
                    }
                  }
                  break;
              }
            } else {
              switch (data.type) {
                case "updateUserList":
                  if (currentGroup == data.groupID) {
                    updateUserListUI(data.memList,data.Owner);
                  }
                  break;
                case "requestGroupUserList":
                  const packet = {
                    type: "requestServerUserList",
                    groupID: currentGroup,
                    token: mytoken,
                    username: username,
                    userID: myuuid
                  };
                  socket.send(JSON.stringify(packet));
                  break;
                case "sendmessage":
                  if (data.groupID == currentGroup) {
                    makebox(data.message, data.username, false, data.icon, data.badges, data.IsOwner, data.time);
                  }
                  break;
                case "updateGroup":
                  const { groupID, newName, kickUser, joinUser, allmembers } =
                    data;
                  if (groupID === currentGroup) {
                    if (newName) {
                      setGroupName(newName);
                    }
                    if (username == kickUser) {
                      InitChat();
                    }
                  } else {
                    if (username == kickUser) {
                      sendGroupPacket(username);
                    }
                  }
                  getGroupData();
                  break;
              }
            }
          } else {
            MakeErrorMessage(data.message, false);
          }
        } catch (e) {
          console.error("Error parsing message:", e);
        }
      });
    }
    function dumpTheme() {
      const link = document.createElement("a");
      link.style.display = "none";

      const themeJson = {
        accent: localStorage.getItem("--accent-color"),
        secondary_bg: localStorage.getItem("--secondary-bg"),
        primary_bg: localStorage.getItem("--background"),
        sidebar: localStorage.getItem("--sidebar"),
        text: localStorage.getItem("--text-color"),
        input_bg: localStorage.getItem("--input-bg"),
      };

      navigator.clipboard.writeText(JSON.stringify(themeJson))
    }
    function setTheme(themejs) {
      console.log("Setting theme...");
      console.log(themejs);
      const accentColor = themejs.accent;
      document.body.style.setProperty("--accent-color", accentColor);
      localStorage.setItem("--accent-color", accentColor);

      const SecondaryBGColor = themejs.secondary_bg;
      document.body.style.setProperty("--secondary-bg", SecondaryBGColor);
      localStorage.setItem("--secondary-bg", SecondaryBGColor);

      const PrimaryBGColor = themejs.primary_bg;
      document.body.style.setProperty("--background", PrimaryBGColor);
      localStorage.setItem("--background", PrimaryBGColor);

      const SidebarColor = themejs.sidebar;
      document.body.style.setProperty("--sidebar", SidebarColor);
      localStorage.setItem("--sidebar", SidebarColor);

      const TextColor = themejs.text;
      document.body.style.setProperty("--text-color", TextColor);
      localStorage.setItem("--text-color", TextColor);

      const InputBGColor = themejs.input_bg;
      document.body.style.setProperty("--input-bg", InputBGColor);
      localStorage.setItem("--input-bg", InputBGColor);
    }

    function switchPreset() {
      // Theme names correspond the <option> value tags
      const themes = {
        "dracula-oled": { "accent": "#ff7800", "secondary_bg": "#000000", "primary_bg": "#000000", "sidebar": "#000000", "text": "#8ff0a4", "input_bg": "#241f31" },
        "simple-dark-red": { "accent": "#e01b24", "secondary_bg": "#3d3846", "primary_bg": "#3d3846", "sidebar": "#3d3846", "text": "#f66151", "input_bg": "#5e5c64" },
        "simple-dark-green": { "accent": "#33d17a", "secondary_bg": "#3d3846", "primary_bg": "#3d3846", "sidebar": "#3d3846", "text": "#8ff0a4", "input_bg": "#5e5c64" },
        "simple-dark-blue": { "accent": "#3584e4", "secondary_bg": "#3d3846", "primary_bg": "#3d3846", "sidebar": "#3d3846", "text": "#99c1f1", "input_bg": "#5e5c64" },
        "simple-dark-yellow": { "accent": "#f5c211", "secondary_bg": "#3d3846", "primary_bg": "#3d3846", "sidebar": "#3d3846", "text": "#f9f06b", "input_bg": "#5e5c64" },
        "zesty-bright": {"accent":"#ff7800","secondary_bg":"#ffffff","primary_bg":"#ffffff","sidebar":"#deddda","text":"#000000","input_bg":"#62a0ea"},
        "zesty-dark": {"accent":"#e66100","secondary_bg":"#3d3846","primary_bg":"#3d3846","sidebar":"#5e5c64","text":"#ffffff","input_bg":"#3584e4"},
        "zesty-oled": {"accent":"#e66100","secondary_bg":"#000000","primary_bg":"#000000","sidebar":"#241f31","text":"#ffffff","input_bg":"#1a5fb4"},
      };
      const comboBoxVal = document.getElementById("color-schemes-box").value;
      setTheme(themes[comboBoxVal]);
    }

    function openUserSettingsPopup() {
      const overlay = document.getElementById("UserSettingsOverlay");
      const popup = document.getElementById("UserSettingsPopup");

      overlay.style.display = "block";
      popup.style.display = "flex";

      popup.innerHTML = `
         <div class='GroupSettingsTitle' style='margin-top:1vw;'>User Settings</div>
         <label style='width:90%;font-size:1vw;'>Profile Icon</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' placeholder='User Profile Icon URL' id='UserIconURL' />
           <button class='content-bt' style='width:4vw;' id='saveiconbt'>Save</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Color Schemes</label>
         <div class='usersettingscontainer'>
           <select name="color-schemes" id="color-schemes-box" onchange=switchPreset()>
             <option value="" selected disabled hidden>-- Choose a theme --</option>
             <option value="dracula-oled">Dracula OLED</option>
             <option value="simple-dark-red">Simple Dark - Red</option>
             <option value="simple-dark-green">Simple Dark - Green</option>  
             <option value="simple-dark-blue">Simple Dark - Blue</option>
             <option value="simple-dark-yellow">Simple Dark - Yellow</option>
             <option value="zesty-bright">Zesty Bright</option>
             <option value="zesty-dark">Zesty Dark</option>
             <option value="zesty-oled">Zesty OLED</option>
           </select>
           <button class='content-bt' id='save-theme' onclick=dumpTheme()>Copy theme JSON to clipboard</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Change Accent Color</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' style='margin-top:0.5vw' type='color' id='input-accent_color' />
           <button class='content-bt' style='width:4vw;' id='save-accent_color'>Save</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Change Background</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' style='margin-top:0.5vw' type='color' id='input-background' />
           <button class='content-bt' style='width:4vw;' id='save-background'>Save</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Change Secondary Background</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' style='margin-top:0.5vw' type='color' id='input-secondary-background' />
           <button class='content-bt' style='width:4vw;' id='save-secondary-background'>Save</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Change Sidebar</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' style='margin-top:0.5vw' type='color' id='input-sidebar' />
           <button class='content-bt' style='width:4vw;' id='save-sidebar'>Save</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Change Text Color</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' style='margin-top:0.5vw' type='color' id='input-text_color' />
           <button class='content-bt' style='width:4vw;' id='save-text_color'>Save</button>
         </div>
         <label style='width:90%;font-size:1vw;'>Change Input Color</label>
         <div class='usersettingscontainer'>
           <input class='group-settings-input' style='margin-top:0.5vw' type='color' id='input-input-bg' />
           <button class='content-bt' style='width:4vw;' id='save-input-bg'>Save</button>
         </div>
         `;

      document.getElementById("input-accent_color").value =
        localStorage.getItem("--accent-color") ||
        getComputedStyle(document.documentElement)
          .getPropertyValue("--accent-color")
          .trim();
      document
        .getElementById("save-accent_color")
        .addEventListener("click", () => {
          const newValue =
            document.getElementById("input-accent_color").value;
          document.body.style.setProperty("--accent-color", newValue);
          localStorage.setItem("--accent-color", newValue);
        });

      document.getElementById("input-secondary-background").value =
        localStorage.getItem("--secondary-bg") ||
        getComputedStyle(document.documentElement)
          .getPropertyValue("--secondary-bg")
          .trim();
      document
        .getElementById("save-secondary-background")
        .addEventListener("click", () => {
          const newValue = document.getElementById(
            "input-secondary-background"
          ).value;
          document.body.style.setProperty("--secondary-bg", newValue);
          localStorage.setItem("--secondary-bg", newValue);
        });
      document.getElementById("input-background").value =
        localStorage.getItem("--background") ||
        getComputedStyle(document.documentElement)
          .getPropertyValue("--background")
          .trim();
      document
        .getElementById("save-background")
        .addEventListener("click", () => {
          const newValue = document.getElementById("input-background").value;
          document.body.style.setProperty("--background", newValue);
          localStorage.setItem("--background", newValue);
        });
      document.getElementById("input-sidebar").value =
        localStorage.getItem("--sidebar") ||
        getComputedStyle(document.documentElement)
          .getPropertyValue("--sidebar")
          .trim();
      document
        .getElementById("save-sidebar")
        .addEventListener("click", () => {
          const newValue = document.getElementById("input-sidebar").value;
          document.body.style.setProperty("--sidebar", newValue);
          localStorage.setItem("--sidebar", newValue);
        });

      document.getElementById("input-text_color").value =
        localStorage.getItem("--text-color") ||
        getComputedStyle(document.documentElement)
          .getPropertyValue("--text-color")
          .trim();
      document
        .getElementById("save-text_color")
        .addEventListener("click", () => {
          const newValue = document.getElementById("input-text_color").value;
          document.body.style.setProperty("--text-color", newValue);
          localStorage.setItem("--text-color", newValue);
        });
      document.getElementById("input-input-bg").value =
        localStorage.getItem("--input-bg") ||
        getComputedStyle(document.documentElement)
          .getPropertyValue("--input-bg")
          .trim();
      document
        .getElementById("save-input-bg")
        .addEventListener("click", () => {
          const newValue = document.getElementById("input-input-bg").value;
          document.body.style.setProperty("--input-bg", newValue);
          localStorage.setItem("--input-bg", newValue);
        });

      document.getElementById("saveiconbt").addEventListener("click", () => {
        const url = document.getElementById("UserIconURL").value;
        if (url) {
          if (socket.readyState === WebSocket.OPEN) {
            const payload = {
              type: "updateuser",
              userID: myuuid,
              username: username,
              newIcon: url,
              token: mytoken,
            };
            socket.send(JSON.stringify(payload));
          }
        }
      });

      overlay.classList.remove("HideOverlayAnim");
      popup.classList.remove("UserSettingsPopupHide");
      overlay.classList.add("ShowOverlayAnim");
      popup.classList.add("UserSettingsPopupShow");

      overlay.addEventListener("click", closeUserSettingsPopup);
    }

    function closeUserSettingsPopup() {
      const overlay = document.getElementById("UserSettingsOverlay");
      const popup = document.getElementById("UserSettingsPopup");

      overlay.classList.remove("ShowOverlayAnim");
      popup.classList.remove("UserSettingsPopupShow");
      overlay.classList.add("HideOverlayAnim");
      popup.classList.add("UserSettingsPopupHide");

      overlay.addEventListener("animationend", function hideOverlay() {
        overlay.style.display = "none";
        overlay.removeEventListener("animationend", hideOverlay);
        popup.removeEventListener("animationend", hidePopup);
      });
      overlay.removeEventListener("click", closeUserSettingsPopup);
    }

    InitLogin();
    ConnectToServer();
  </script>
</body>

</html>